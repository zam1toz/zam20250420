# CrewAI 여행 일정 플래너 실습 가이드

이번 세션에서는 **CrewAI 기반 여행 일정 플래너** 프로젝트의 구조를 이해하고 코드를 실행해보겠습니다. 또한 여행 요청 **프롬프트를 변경(튜닝)**하여 각 에이전트의 응답이 어떻게 달라지는지 살펴보는 연습을 합니다. 이 가이드는 초보 학습자를 대상으로 하며, 단계별 설명과 예제를 통해 프로젝트 아키텍처를 쉽게 이해할 수 있도록 작성되었습니다.

## 프로젝트 파일 구성 개요

이 프로젝트는 여러 개의 Python 파일로 구성되어 있으며, 각 파일이 맡은 역할은 다음과 같습니다:

- **`main.py`** – 프로그램의 진입점(엔트리 포인트)입니다. 예시 여행 요청을 입력으로 설정하고, **여행 코디네이터 Crew**를 생성하여 일정을 생성합니다. 마지막으로 생성된 여행 일정을 콘솔에 출력합니다.
- **`app.py`** – 웹 인터페이스를 위한 스트림릿(Streamlit) 애플리케이션입니다. 사용자가 웹 브라우저에서 여행 계획 요청을 입력하면, `main.py`와 동일한 로직으로 Crew를 실행해 결과를 화면에 보여줍니다. GUI 환경에서 **인터랙티브하게** 여행 일정을 생성할 수 있습니다.
- **`crew.py`** – **CrewAI 프레임워크**를 활용하여 *Crew*(에이전트 팀)를 구성하는 파일입니다. 여기서 `TravelCoordinatorCrew` 클래스가 정의되며, 내부에서 여러 에이전트와 태스크를 모아 하나의 Crew를 만들어주는 역할을 합니다. (예: 어떤 에이전트들이 어떤 순서로 협력할지 설정)
- **`agents.py`** – 프로젝트에서 사용하는 **에이전트(Agent)**들을 정의하는 파일입니다. 각 에이전트는 특정 역할과 목표를 갖습니다. 예를 들어, 여행 정보 수집을 담당하는 에이전트, 현지 추천을 담당하는 에이전트, 최종 일정을 조율하는 코디네이터 에이전트 등이 여기에 정의됩니다. 각 에이전트는 자신의 역할에 따라 **툴(tool)**을 사용하기도 합니다.
- **`tasks.py`** – 각 단계별 **태스크(Task)**를 정의한 파일입니다. 태스크는 에이전트가 수행해야 할 업무를 나타내며, 설명(`description`), 기대 출력(`expected_output`), 담당 에이전트(`agent`), 그리고 이전 단계 참조(`context`) 등의 정보를 포함합니다. 이 파일에서는 여행 일정 생성 과정의 3단계 태스크 (기본 일정 수립, 현지 추천 추가, 최종 일정 정리)가 정의되어 있습니다.
- **`tools.py`** – 에이전트들이 활용하는 **도구(Tool)**들을 정의한 파일입니다. 예를 들어, 항공편 정보를 검색하는 도구(`FlightSearchTool`), 호텔 정보를 검색하는 도구(`HotelSearchTool`), 관광지/맛집 등 현지 장소 정보를 찾는 도구(`NearbyPlacesTool`), 환율 정보를 제공하는 도구(`ExchangeRateTool`) 등이 있습니다. 에이전트는 자신의 역할에 맞게 이러한 도구들을 사용하여 실제 정보를 조회하고 활용할 수 있습니다.

## CrewAI 에이전트, 태스크, 도구의 상호작용

이 여행 플래너는 **여러 AI 에이전트가 협업**하여 사용자에게 최적의 여행 일정을 만들어주는 구조로 설계되었습니다. CrewAI 프레임워크의 핵심 구성 요소인 **에이전트(Agent)**, **태스크(Task)**, **도구(Tool)**가 어떻게 상호작용하는지 단계별로 살펴보겠습니다:

1. **1단계 – 기본 여행 정보 수집 및 일정 초안**: *여행 전문가 에이전트*가 사용자 요청을 받아 **기본 여행 일정을 작성**합니다. 이 에이전트는 항공편과 숙소 같은 핵심 정보를 수집하는 역할을 하며, 필요에 따라 항공편 검색 도구와 호텔 검색 도구를 사용합니다. 예를 들어, 여행자가 입력한 날짜와 목적지에 맞는 **왕복 항공편**과 **호텔 예약 정보**를 조회하고, 예산을 고려한 **1일차, 2일차 일정 초안**을 작성합니다. 이 단계의 결과물은 **항공편 일정, 숙박 계획 및 대략적인 비용**을 포함한 여행 일정 초안입니다.

2. **2단계 – 현지 추천 추가 및 예산 상세화**: *현지 전문가 에이전트*가 1단계 초안을 검토한 뒤, 일자별 일정에 **현지 맛집 추천, 가볼 만한 명소 추가** 그리고 세부 **예산 내역**을 작성합니다. 이 에이전트는 현지 정보를 찾아주는 역할로, 필요시 현지 장소 검색 도구(`NearbyPlacesTool`)를 사용하여 **목적지 주변의 인기 맛집이나 관광지**를 찾아내고 일정에 추가합니다. 또한 환율 변환 도구(`ExchangeRateTool`)를 활용하여 여행 경비를 원화 기준으로 계산하고, **항목별 예산표**를 상세히 작성합니다. 이 단계에서는 1단계 결과(기본 일정)를 **context(맥락)**로 참고하여, 그 내용에 **식사 계획, 추가 방문지, 세부 비용** 등을 덧붙입니다. 결과적으로 여행 일정이 더욱 풍부해지고, **구체적인 예산 계획**이 수립됩니다.

3. **3단계 – 전체 일정 최종 조율**: *여행 일정 코디네이터 에이전트*가 앞서 나온 모든 정보를 종합하여 **최종 여행 일정표**를 완성합니다. 이 에이전트의 역할은 **전체 계획을 조정하고 정리**하는 것입니다. 2단계까지 만들어진 일정과 예산 정보를 받아서, 사용자가 보기 편하도록 **일자별로 깔끔하게 정리된 여행 일정**을 작성합니다. 항공편 및 숙소 정보, 현지 맛집과 명소, 상세 예산 등이 빠짐없이 포함되도록 확인하고, 표현을 다듬어 최종 결과물을 제공합니다. 이 단계의 출력은 고객에게 직접 전달할 수 있는 **완성된 여행 일정 계획서**입니다.

각 단계는 **CrewAI의 Crew 워크플로우** 내에서 순차적으로 실행됩니다. `crew.py`에서 설정한 `Process.sequential`에 따라 1→2→3 단계가 차례로 이루어지며, 이전 단계의 출력은 다음 단계의 에이전트에게 **context**로 전달됩니다. 예를 들어, `tasks.py`에서 2단계 태스크(`local_recommendation_task`)는 `context=[initial_travel_plan_task]`로 정의되어 있어 1단계 결과를 입력으로 받고, 3단계 태스크는 2단계 결과를 입력으로 받도록 설정됩니다. 이렇게 함으로써 에이전트들이 **협업하여 하나의 일관된 일정**을 완성하게 됩니다. 에이전트들은 각자의 `role`(역할)과 `goal`(목표)에 따라 해당 단계의 임무를 수행하며, 필요할 경우 자신에게 할당된 `tools`를 사용해 실제 데이터(예: 항공편 가격, 환율 정보 등)를 얻습니다. 

> **예시:** 여행자가 오사카 여행을 요청하면, 1단계 여행 전문가 에이전트는 Amadeus API를 통해 인천-오사카 왕복항공편과 오사카 호텔 정보를 찾아 예산 내에 맞는 항공편 시간표와 숙소 예약안을 제시합니다. 이어서 2단계 현지 전문가 에이전트는 Google Places API를 통해 오사카 현지의 유명 식당이나 관광지를 검색해 일정을 풍성하게 하고, 환율 정보를 반영해 엔화 비용을 한화로 환산한 상세 예산을 작성합니다. 마지막으로 3단계 코디네이터 에이전트가 이 모든 정보를 모아 "1일차: ..., 2일차: ..." 형식의 최종 일정표를 정리합니다.

## 코드 실행 흐름: `main.py`와 `app.py`

이 섹션에서는 실제 코드가 어떻게 동작하는지, `main.py` (콘솔 모드)와 `app.py` (웹 앱 모드)를 기준으로 단계별 흐름을 설명합니다.

- **`main.py` (터미널에서 실행)**:  
  1. `main.py`를 실행하면, 우선 `run()` 함수 내에서 예시 **입력 데이터**를 준비합니다. 이 입력은 여행 요청 문자열로서 `inputs = {'content': "<여행 요청 내용>"}` 형태의 딕셔너리에 담깁니다. 예시로 코드는 다음과 같은 내용을 `content`에 담고 있습니다:
     ``` 
     2025년 4월 25일부터 27일까지 인천을 출발해서 오사카로 여행을 다녀오려고 합니다. 
     항공편, 숙소, 현지 맛집, 가볼만한 곳까지 포함해서 여행 일정을 상세히 만들어주세요. 
     예산은 총 80만 원 이내로 잡고 있어요. 
     혼자 가는 여행이라 너무 비싸지 않으면서 가성비 좋은 곳들로 부탁드려요.
     ``` 
     *(사용자는 이 내용을 자유롭게 변경할 수 있습니다.)*
  2. 다음으로 `TravelCoordinatorCrew().crew()`를 호출하여 **Crew 객체**를 생성합니다. 이 Crew에는 앞서 `crew.py`에서 정의한 대로 3명의 에이전트(여행 전문가, 현지 전문가, 코디네이터)와 3개의 태스크가 설정됩니다.
  3. `crew().kickoff(inputs=inputs)`를 호출하면, CrewAI 프레임워크가 준비된 에이전트들과 태스크를 **순차적으로 실행**합니다. 이때 `inputs`에 넣었던 여행 요청 문장이 1단계 태스크에 전달되어 첫 번째 에이전트가 작업을 시작합니다. 이어서 각 단계가 차례로 실행되고, 내부적으로 에이전트들이 필요한 경우 API 도구를 호출하며 결과를 만들어냅니다.
  4. 모든 태스크가 끝나면 `kickoff` 메서드는 **최종 완성된 여행 일정 결과물**을 반환합니다. 이 결과는 문자열 형태의 일정표이며, `result` 변수에 저장됩니다.
  5. `main.py`는 마지막으로 `print(result)`를 수행하여 생성된 여행 일정을 터미널에 출력합니다. 사용자는 콘솔 창에서 일자별 여행 일정과 예산 내역 등이 포함된 결과를 확인할 수 있습니다.

- **`app.py` (웹 인터페이스 실행)**:  
  1. `app.py`는 Streamlit 라이브러리를 사용하여 웹 UI를 구성합니다. 실행 시 웹 브라우저에 **"🚀 여행 일정 계획 챗봇"**이라는 제목과 함께 텍스트 입력란이 표시됩니다. 이 입력란에는 기본값으로 위와 동일한 예시 여행 요청이 미리 채워져 있습니다. 사용자는 해당 텍스트를 수정하거나 그대로 두고, 원하는 여행 계획 요청을 입력할 수 있습니다.
  2. UI에서 "**여행 일정 생성하기**" 버튼을 누르면, 앱은 내부적으로 `TravelCoordinatorCrew().crew().kickoff(inputs=...)`를 호출하여 앞서 `main.py`에서 설명한 것과 동일한 처리를 수행합니다. 이 과정에서 `user_input`으로 받아온 사용자의 여행 요청을 `inputs['content']`로 설정하고 Crew를 실행합니다.
  3. 여행 일정을 생성하는 동안 "*일정을 생성 중입니다...*"라는 로딩 메시지가 표시되고, 백엔드에서 세 단계의 에이전트 작업이 순차적으로 진행됩니다.
  4. 완료되면 "*여행 일정 생성 완료!*"라는 메시지와 함께 **생성된 여행 일정 결과**가 화면에 출력됩니다. Streamlit 앱은 `st.markdown(result)`를 통해 최종 일정을 보기 좋게 렌더링해 줍니다. 사용자는 웹 페이지에서 일정을 스크롤하며 세부 내용을 확인할 수 있습니다 (예: 1일차에 어디 방문, 비용 얼마 등).  
  *참고로, `app.py`에서도 콘솔에 `print(result)`를 해두었으므로, 개발자는 터미널에서도 결과 문자열을 확인할 수 있습니다.*

이처럼 `main.py`와 `app.py`는 기본적으로 **같은 로직**을 다른 인터페이스에서 실행합니다. 하나는 콘솔 출력을, 다른 하나는 웹 인터페이스를 제공하므로, 편한 방법으로 실행해서 결과를 확인하면 됩니다.

## 코드 실행 방법 및 입력 제공

이제 직접 코드를 실행해 보겠습니다. 아래 지침에 따라 진행하세요:

1. **환경 설정**: 프로젝트를 실행하기 전에 필요한 파이썬 패키지와 API 키를 설정했는지 확인합니다. 최소한 CrewAI 프레임워크와 Streamlit이 설치되어 있어야 하며, `tools.py`에서 사용되는 외부 API(Key)들이 설정되어야 합니다.  
   - Amadeus 항공편/호텔 API 키 (`AMADEUS_CLIENT_ID`, `AMADEUS_CLIENT_SECRET`),  
   - Google Places API 키 (`GOOGLE_API_KEY`),  
   - ExchangeRate API 키 (`EXCHANGE_RATE_API_KEY`) 등을 `.env` 파일에 미리 넣어두세요.  
   **🔑 참고:** API 키를 설정하지 않으면 도구 사용 시 인증 에러가 발생할 수 있으므로, 키가 없다면 키 발급 및 설정을 완료해야 합니다.

2. **터미널에서 실행하기 (`main.py`)**: 터미널이나 명령 프롬프트에서 프로젝트 디렉토리로 이동한 후, 다음 명령을 실행합니다:
   ```bash
   python main.py
   ``` 
   명령을 실행하면 프로그램이 앞서 설명한 입력으로 Crew를 실행하고, 최종 생성된 여행 일정 결과를 출력합니다. 출력된 텍스트를 확인하여 **일정이 논리적으로 잘 구성되었는지**, **요청한 조건(날짜, 도시, 예산 등)이 반영되었는지** 살펴보세요. 예시 입력의 경우, 인천->오사카 2박3일 일정에 대한 항공편, 호텔, 식사/관광, 예산 정보 등이 포함된 플랜이 터미널에 표시될 것입니다.

3. **웹 앱으로 실행하기 (`app.py`)**: 터미널에서 다음 명령을 실행합니다:
   ```bash
   streamlit run app.py
   ``` 
   명령을 실행하면 웹 브라우저가 열리거나 터미널에 로컬 주소(URL)가 표시됩니다. 브라우저에서 해당 주소 (예: `http://localhost:8501`)로 접속하면 웹 인터페이스가 나타납니다. 안내에 따라 텍스트 영역에 여행 요청을 입력하고 **"여행 일정 생성하기"** 버튼을 클릭하세요. 잠시 기다리면 아래에 생성된 일정이 표시됩니다. 스크롤하여 결과를 확인하고, 필요한 경우 텍스트를 수정한 뒤 다시 버튼을 눌러 새로운 결과를 얻을 수 있습니다.

4. **결과 확인**: 어느 방법으로 실행하든, **생성된 일정 결과**를 꼼꼼히 확인해보세요. 일정에는 **출발일과 도착일**별 계획, **항공편 정보**, **숙소 정보**, **추천 식당/명소**, **예산 내역** 등이 포함됩니다. 이때 출력이 요구사항에 맞게 구성되었는지 검토하고, 각 부분이 어느 에이전트의 기여로 만들어졌을지 생각해봅시다 (앞 단계에서 알아본 1~3단계와 결과물을 대조하면 도움이 됩니다).

## 프롬프트 튜닝 실습: 입력 변경해 보기

이제 여행 요청 **프롬프트를 수정하거나 새로운 요청을 입력**하여, 결과가 어떻게 달라지는지 실습해보겠습니다. 작은 변화로도 각 단계의 출력 내용이 어떻게 바뀌는지 확인해보세요:

- **날짜나 기간 변경**: 예를 들어 여행 기간을 늘리거나 줄여봅니다. "2박 3일" 여행을 "3박 4일"로 바꾸거나, 다른 월/일자로 변경해보세요.  
  → 1단계 에이전트는 **변경된 날짜에 맞는 항공편** 일정을 제시할 것이고, 숙박 일정도 그에 맞춰 늘어나거나 줄어듭니다. 2단계 에이전트는 **추가된 일자에 추천할 현지 활동**을 더 포함하거나, 짧아진 일정에 맞게 내용을 조정합니다. 최종 결과에서 전체 일정 표기도 변경된 기간을 반영하게 됩니다.

- **출발지 또는 목적지 변경**: 인천 대신 다른 출발 공항을 넣거나, 오사카 대신 다른 여행지를 요청해보세요 (예: "부산을 출발해서 도쿄로 여행...").  
  → 1단계에서는 **새로운 경로에 대한 항공편 정보**와 해당 도시의 호텔 정보를 검색합니다. 2단계 현지 전문가는 **새 목적지에 맞는 맛집/명소**를 추천할 것입니다. 예를 들어 도쿄로 바꾸면, 오사카 맛집 대신 도쿄의 유명 맛집과 관광지가 나올 것입니다. 일정 전체의 흐름은 동일하지만, 콘텐츠가 **여행지에 맞춰 변화**하는 것을 볼 수 있습니다.

- **예산 변경**: "예산 80만 원" 부분을 더 낮추거나 높여서 입력해보세요.  
  → 그러면 에이전트들이 **가격에 민감한 선택**을 하도록 답변이 달라질 수 있습니다. 1단계 에이전트는 예산 범위 내의 항공편/숙소를 찾으려고 할 것이고, 2단계 에이전트는 식사나 액티비티 추천 시 **비용이 적게 드는 옵션**을 더 고려할 것입니다. 최종 일정의 예산표에서도 변경된 예산 한도가 반영됩니다.

- **추가 요구사항 넣기**: 프롬프트에 개인 취향이나 추가 요청을 넣어보세요. 예를 들어 "*... 그리고 온천을 꼭 가보고 싶어요.*" 혹은 "*... 아이와 함께 가는 여행입니다.*" 등의 문장을 추가합니다.  
  → LLM 기반 에이전트는 이러한 추가 요구사항을 읽고 **일정에 반영하려고 시도**합니다. 온천을 언급하면 현지 전문가 에이전트가 온천 방문 일정을 포함할 수 있고, "아이와 함께"라는 정보를 주면 가족 친화적인 장소를 추천하는 등의 변화를 기대할 수 있습니다. (물론 명시적으로 코드에 구현된 규칙은 없지만, 언어 모델이 문맥을 반영하여 답변할 것입니다.)

각 시나리오별로 `main.py`를 재실행하거나, Streamlit 웹 앱에서 프롬프트를 수정한 후 **다시 실행하여 결과를 비교**해 보세요. 가능하면 이전에 얻은 일정과 새로운 일정을 나란히 놓고 무엇이 달라졌는지 살펴봅시다. 특히 **어느 에이전트의 출력 내용이 달라졌는지** 추적해보면 유익합니다. (예: 항공편/숙소 변화 → 여행 전문가 에이전트의 영향, 맛집/명소 변화 → 현지 전문가 에이전트의 영향, 표현이나 전체 구성 변화 → 코디네이터 에이전트의 영향)

> **Tip:** 콘솔에서 실행할 때 `crew.py`의 `verbose=True` 설정 덕분에 각 단계별로 에이전트가 출력하는 내용을 중간중간 프린트해줄 수 있습니다. 만약 터미널 로그에 단계별 메시지가 나타나면 이를 확인하여 **1단계 출력 -> 2단계 출력 -> 3단계 출력** 흐름을 더욱 명확히 이해해보세요. (로그 형식은 CrewAI 프레임워크에 따라 다를 수 있습니다.) 

프롬프트 튜닝을 통해 **요구사항을 조금만 바꿔도 일정 결과가 유연하게 달라지는 것**을 확인했다면, 멀티에이전트 시스템의 대응력과 LLM 기반 생성의 묘미를 체험하신 것입니다.

## 최종 점검: 학습 내용 체크리스트

마지막으로, 이번 세션에서 다룬 내용을 정리하면서 몇 가지를 점검해봅시다. 다음 항목을 하나씩 확인해보세요:

- [ ] **프로젝트 구조 이해**: 각 파일(`main.py`, `app.py`, `crew.py`, `agents.py`, `tasks.py`, `tools.py`)의 역할을 설명할 수 있다. 어떤 파일에 어떤 내용이 정의되어 있는지 개략적으로 파악했다.
- [ ] **멀티 에이전트 워크플로우 파악**: 여행 일정 생성이 3단계에 걸쳐 이루어짐을 이해했다. 각 단계에서 **어느 에이전트**가 **어떤 임무**를 수행하고, 그 결과가 다음 단계로 **어떻게 전달**되는지 설명할 수 있다.
- [ ] **코드 실행 및 결과 확인**: `main.py`를 직접 실행하여 콘솔에 출력된 여행 일정을 확인했고, 필요하다면 `app.py`의 스트림릿 웹 앱을 실행하여 인터랙티브하게 결과를 얻어보았다.
- [ ] **프롬프트 변경 실험**: 예시 입력 문장을 최소 한 가지 이상 변경하여 코드를 다시 실행해 보았다. 그 결과 일정 내용에 변화가 생기는 것을 확인했고, **왜 그런 변화가 나타났는지** 이해했다 (어느 부분을 변경하였더니 어느 에이전트의 출력이 달라졌는가 등).
- [ ] **이해도 향상**: 이제 이 CrewAI 기반 여행 플래너의 아키텍처를 전반적으로 이해하고 있으며, 간단한 수정(예를 들어 에이전트의 역할 설명 조정이나 새로운 도구 추가)을 시도해볼 수 있을 것 같다. 또한 멀티에이전트 시스템이 어떻게 협업하여 하나의 완성된 결과물을 내놓는지 개념을 익혔다.

위 항목들을 모두 만족한다면, 여러분은 **프로젝트의 구조를 성공적으로 이해**하고 **코드 실행 및 응용** 능력을 갖춘 것입니다! 🎉 이번 실습을 통해 얻은 지식을 바탕으로, 다음 세션에서는 더 심화된 주제나 응용을 다룰 수 있을 것입니다. 수고하셨습니다.


